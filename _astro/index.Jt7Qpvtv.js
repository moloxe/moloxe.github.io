import{_ as W}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as D,c as O,o as X,a as C,b as F,t as K,q as R,r as v,s as G,g as L,j as $,k as j,F as z,h as q}from"./runtime-core.esm-bundler.Ds1MczRr.js";const N=16,P=8,B=40,A={idle:[[-3,-3]],alert:[[-7,-3]],scratch:[[-5,0],[-6,0],[-7,0]],tired:[[-3,-2]],sleeping:[[-2,0],[-2,-1]],N:[[-1,-2],[-1,-3]],NE:[[0,-2],[0,-3]],E:[[-3,0],[-3,-1]],SE:[[-5,-1],[-5,-2]],S:[[-6,-3],[-7,-2]],SW:[[-5,-3],[-6,-1]],W:[[-4,-2],[-4,-3]],NW:[[-1,0],[-1,-1]]},H={src:"/_astro/oneko.tF4QjMy6.gif",width:256,height:128,format:"gif"},V=D({__name:"OnekoSingle",props:{oneko:{},allowAlert:{type:Boolean},forceAlert:{type:Boolean}},setup(Y,{expose:h}){h();const e=Y,n=v(),u=v(!1),_=v(!1),c=v();G(u,()=>{u.value?_.value=!0:_.value=!1}),L(()=>{const a=n.value;if(!a)return;a.style.left=e.oneko.posX+"px",a.style.top=e.oneko.posY+"px";let T=0,f=0,g=null,l=0;function i(s){const k=A[e.oneko.sprite][s%A[e.oneko.sprite].length];a&&(a.style.backgroundPosition=`${k[0]*32}px ${k[1]*32}px`)}function y(){T+=1;const s=e.oneko.posX-e.oneko.targetX,k=e.oneko.posY-e.oneko.targetY,r=Math.sqrt(s**2+k**2);if(e.forceAlert){e.oneko.sprite="alert",i(0);return}if(r<N||r<B){switch(f+=1,f>10&&Math.floor(Math.random()*200)==0&&g==null&&(g=["sleeping","scratch"][Math.floor(Math.random()*2)]),g){case"sleeping":if(l<8){e.oneko.sprite="tired",i(0);break}e.oneko.sprite="sleeping",i(Math.floor(l/4)),l>192&&(g=null,l=0);break;case"scratch":e.oneko.sprite="scratch",i(l),l>9&&(g=null,l=0);break;default:e.oneko.sprite="idle",i(0);return}l+=1;return}if(g=null,l=0,f>1){e.allowAlert?(e.oneko.sprite="alert",i(0),f=Math.min(f,7),f-=1):(e.oneko.sprite="idle",i(0),f=0);return}let t="idle";k/r>.5?(t="N",s/r>.5?t="NW":s/r<-.5&&(t="NE")):k/r<-.5?(t="S",s/r>.5?t="SW":s/r<-.5&&(t="SE")):s/r>.5?t="W":s/r<-.5&&(t="E"),e.oneko.sprite=t,i(T),a&&(a.style.left=`${e.oneko.posX-16}px`,a.style.top=`${e.oneko.posY-16}px`)}c.value=setInterval(y,100)}),$(()=>{clearInterval(c.value)});const m={props:e,onekoRef:n,hovered:u,showMessage:_,animationInvervalId:c,get OnekoGif(){return H}};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),Q={key:0,class:"z-50 absolute top-[-1rem] flex gap-1 w-max text-xs bg-white text-black"};function U(Y,h,e,n,u,_){return X(),O("div",{style:R({width:"32px",height:"32px",position:"absolute",backgroundImage:`url(${n.OnekoGif.src})`,imageRendering:"pixelated"}),ref:"onekoRef",class:"z-40 print:hidden",onMouseover:h[0]||(h[0]=c=>n.hovered=!0),onMouseleave:h[1]||(h[1]=c=>n.hovered=!1)},[n.showMessage?(X(),O("span",Q,[F("p",null,K(n.props.oneko.message),1)])):C("",!0)],36)}const J=W(V,[["render",U]]),w=300,Z=D({__name:"index",setup(Y,{expose:h}){h();const e=v([]),n=v([]),u=v(null),_=v();function c(){return"refresh = kill me ðŸ˜”"}function m(t,p=0){const d=n.value.length,o=Math.max(d-1-t*P+p,0);return n.value[o]}function a(){const t=Math.random().toString();let p=Math.floor(document.body.clientWidth/2)-16,d=16;if(e.value.length>0){const M=e.value.length,x=m(M);p=x.x,d=x.y}const o=e.value[e.value.length-1],S=o?.posX??p,E=o?.posY??d;e.value.push({posX:p,posY:d,targetX:S,targetY:E,message:c(),id:t,sprite:"idle"})}function T(){if(e.value.length===0)return;let t=!1;if(u.value){const o=e.value[0],S=o.posX-o.targetX,E=o.posY-o.targetY,M=Math.sqrt(S**2+E**2);let x=o.posX,I=o.posY;M>B&&o.sprite!=="alert"&&(x=o.posX-S/M*N,I=o.posY-E/M*N,t=!0,n.value.push({x,y:I})),e.value[0]={...o,posX:x,posY:I,targetX:u.value.x,targetY:u.value.y}}for(let o=1;o<e.value.length;o++){const S=m(o),E=S.x,M=S.y;let x=e.value[o].posX,I=e.value[o].posY;if(t){const b=m(o,3);x=b.x,I=b.y}e.value[o]={...e.value[o],posX:E,posY:M,targetX:x,targetY:I}}const p=n.value.length,d=e.value.length*P;p>d&&(n.value=n.value.slice(p-d))}function f(){e.value.length>0?e.value.pop():n.value=[]}function g(t){u.value={x:t.pageX,y:t.pageY}}function l(t){const p=t.metaKey||t.ctrlKey,d=t.shiftKey,o=t.key.toLowerCase();d&&p&&o==="x"&&(t.preventDefault(),a()),d&&p&&o==="z"&&(t.preventDefault(),f())}const i=v(0),y=v(!1),s=v(!1);function k(){if(new Date().getTime()-(i?.value??0)<w){if(s.value)return;if(y.value){y.value=!1,s.value=!0,setTimeout(()=>{f(),s.value=!1},w);return}y.value=!0,setTimeout(()=>{y.value&&!s.value&&a(),y.value=!1},w)}i.value=new Date().getTime()}L(()=>{document.addEventListener("mousemove",g),document.addEventListener("keydown",l),document.addEventListener("touchstart",k),_.value=setInterval(()=>{T()},100),Math.random()<1/2&&a()}),$(()=>{document.removeEventListener("mousemove",g),document.removeEventListener("keydown",l),document.removeEventListener("touchstart",k),clearInterval(_.value),e.value=[]});const r={onekos:e,movementHistory:n,mousePos:u,intervalId:_,getOnekoMessage:c,getRelativePosition:m,addOnekoToStack:a,onChangeTargets:T,killLast:f,onMouseMove:g,onKeyDown:l,lastTap:i,tappedTwice:y,tappedTrice:s,TAP_DELAY:w,onTouchStart:k,OnekoSingle:J};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function ee(Y,h,e,n,u,_){return X(!0),O(z,null,j(n.onekos,(c,m)=>(X(),q(n.OnekoSingle,{key:c.id,oneko:c,allowAlert:m===0,forceAlert:m>0&&n.onekos[0]?.sprite==="alert"},null,8,["oneko","allowAlert","forceAlert"]))),128)}const se=W(Z,[["render",ee]]);export{se as default};
